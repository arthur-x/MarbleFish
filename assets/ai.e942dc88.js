(function(){"use strict";onmessage=l=>{let{snapshot:n,depth:e}=l.data,t=M(n,1),r=[],c=e-2,s=0;for(let i in t){let o=_(n,i);r.push({action:i,score:0,next:o})}for(;r.length>1;){s=0;for(let i=0;i<r.length;i++){let o=r.shift(),u=m(2,o.next,s,1e3,c,1);u>s&&(s=u),o.score=u,r.push(o)}if(r.sort((i,o)=>o.score-i.score),c==e)break;r.splice(Math.round(r.length/(2*e))+1),c+=2}let p=[];for(let i of r)if(i.score==s)p.push(i.action);else break;let f=p[Math.floor(Math.random()*p.length)];postMessage({path:t[f],v:s})};function m(l,n,e,t,r,c){let s=y(n),p=s.player1||s.player2;if(r==0||l==2&&p)return v(n);let f=M(n,l),i=[];for(let u in f){let a=_(n,u);i.push({action:u,score:v(a),next:a})}l==1?i.sort((u,a)=>a.score-u.score):i.sort((u,a)=>u.score-a.score),i.splice(Math.round(i.length/2**c)+1);let o=l==1?0:1e3;for(let u of i){let a=m(3-l,u.next,e,t,r-1,c+1);if(l==1){if(o=Math.max(o,a),o>t||o==t&&c>1)return o;e=Math.max(e,o)}else{if(o=Math.min(o,a),e>o||e==o&&c>1)return o;t=Math.min(t,o)}}return o}function x(l,n){for(let e=0;e<17;e++)for(let t=0;t<17;t++)n[e][t]=l[e][t]}function _(l,n){let e=new Array(17);for(let p=0;p<17;p++)e[p]=new Array(17).fill(0);x(l,e);let t=n.split(","),r=[Number(t[0]),Number(t[1])],c=[Number(t[2]),Number(t[3])],s=l[r[0]][r[1]];return e[r[0]][r[1]]=0,e[c[0]][c[1]]=s,e}function d(l,n,e,t){let r=[[-1,-1],[-1,1],[0,-2],[0,2],[1,-1],[1,1]],c=[],s=[];for(let p of r){let f=p[0],i=p[1],o=n+f,u=e+i;if(!(o>16||o<0||u>16||u<0)){if(l[o][u]==0&&t)c.push([o,u]);else if(l[o][u]>0){let a=o+f,h=u+i;if(a>16||a<0||h>16||h<0)continue;l[a][h]==0&&s.push([a,h])}}}return{crawls:c,jumps:s}}function M(l,n){let e={};for(let t=0;t<17;t++)for(let r=0;r<17;r++)l[t][r]==n&&(e={...e,...g(l,t,r)});return e}function g(l,n,e){let t=l[n][e];l[n][e]=0;let r={},{crawls:c,jumps:s}=d(l,n,e,!0);for(let f of c.concat(s))r[[[n,e],f]]=[[n,e],f];let p=[];for(;s.length!==0;){for(let f of s){let i=d(l,f[0],f[1],!1).jumps;for(let o of i){let u=[[n,e],o];!(o[0]==n&&o[1]==e)&&r[u]==null&&(p.push(o),r[u]=r[[[n,e],f]].concat([o]))}}s=p,p=[]}return l[n][e]=t,r}function v(l){let n=[],e=[];for(let f=0;f<17;f++)for(let i=0;i<17;i++)l[f][i]==1?n.push([f,i]):l[f][i]==2&&e.push([f,i]);let t=-20,r=-20,c=0,s=0;for(let f of n)t+=f[0],c+=Math.abs(Math.abs(f[1]-8)/2-1);for(let f of e)r+=f[0],s+=Math.abs(Math.abs(f[1]-8)/2-1);return t+r+(s-c)/2}function y(l){let n={player1:1,player2:1};for(let e=0;e<17;e++)for(let t=0;t<17;t++)e<4&&l[e][t]!==-1&&l[e][t]!==2&&(n.player2=0),e>12&&l[e][t]!==-1&&l[e][t]!==1&&(n.player1=0);return n}})();
